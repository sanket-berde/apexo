
var Poly1305 = require('../poly1305');
var test = require('tape');
function fromHex(h) {
  h = h.replace(/([^0-9a-f])/g, '');
  return new Buffer(h, 'hex');
}

function bytesEqual(a, b, t) {
    t.equal(a.toString('hex'), b.toString('hex'));
}

function printHex(num, len, padlen, block) {
  var ret = '', pad = '', i;
  for (i=0; i<padlen;i++) pad += '0';
  i = 0;
  while (i < len) {
    var h = num[i].toString(16);
    ret += (pad + h).slice(-padlen);
    ret += ((i%block) === block-1) ? '\n' : ' ';
    i++;
  }
  console.log(ret);
}

function decodeUTF8(s) {
  var i, d = unescape(encodeURIComponent(s)), b = new Uint8Array(d.length);
  for (i = 0; i < d.length; i++) b[i] = d.charCodeAt(i);
  return b;
}
function poly1305_verify(mac1, mac2, t) {
  t.equals(mac1.toString('hex'), mac2.toString('hex'));
}
function poly1305_auth(m, bytes, key) {
  var ctx = new Poly1305(key);
  ctx.update(m, bytes);
  return ctx.finish();
}
function poly1305_test() {
  test('poly1305 test', function (t) {
  var testVectors = [
    {
      input: '27 54 77 61 73 20 62 72 69 6c 6c 69 67 2c 20 61'+
             '6e 64 20 74 68 65 20 73 6c 69 74 68 79 20 74 6f'+
             '76 65 73 0a 44 69 64 20 67 79 72 65 20 61 6e 64'+
             '20 67 69 6d 62 6c 65 20 69 6e 20 74 68 65 20 77'+
             '61 62 65 3a 0a 41 6c 6c 20 6d 69 6d 73 79 20 77'+
             '65 72 65 20 74 68 65 20 62 6f 72 6f 67 6f 76 65'+
             '73 2c 0a 41 6e 64 20 74 68 65 20 6d 6f 6d 65 20'+
             '72 61 74 68 73 20 6f 75 74 67 72 61 62 65 2e',
      key:   '1c 92 40 a5 eb 55 d3 8a f3 33 88 86 04 f6 b5 f0'+
             '47 39 17 c1 40 2b 80 09 9d ca 5c bc 20 70 75 c0',
      tag:   '45 41 66 9a 7e aa ee 61 e7 08 dc 7c bc c5 eb 62'
    },
    {
      input: '48656c6c6f20776f726c6421',
      key:   '746869732069732033322d62797465206b657920666f7220506f6c7931333035',
      tag:   'a6f745008f81c916a20dcc74eef2b2f0'
    },
     {
      input: '00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00'+
             '00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00'+
             '00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00'+
             '00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00'+
             '00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00'+
             '00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00'+
             '00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00'+
             '00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00',
      key:   '00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00'+
              '00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00',
      tag:   '00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00'
    },
     {
      input: '416e79207375626d697373696f6e20746f20746865204945544620696e74656e6465642062792074686520436f6e7472696275746f7220666f72207075626c69636174696f6e20617320616c6c206f722070617274206f6620616e204945544620496e7465726e65742d4472616674206f722052464320616e6420616e792073746174656d656e74206d6164652077697468696e2074686520636f6e74657874206f6620616e204945544620616374697669747920697320636f6e7369646572656420616e20224945544620436f6e747269627574696f6e222e20537563682073746174656d656e747320696e636c756465206f72616c2073746174656d656e747320696e20494554462073657373696f6e732c2061732077656c6c206173207772697474656e20616e6420656c656374726f6e696320636f6d6d756e69636174696f6e73206d61646520617420616e792074696d65206f7220706c6163652c207768696368206172652061646472657373656420746f',
      key:   '00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00'+
              '36 e5 f6 b5 c5 e0 60 70 f0 ef ca 96 22 7a 86 3e',
      tag:   '36 e5 f6 b5 c5 e0 60 70 f0 ef ca 96 22 7a 86 3e'
    },
     {
      input: '416e79207375626d697373696f6e20746f20746865204945544620696e74656e6465642062792074686520436f6e7472696275746f7220666f72207075626c69636174696f6e20617320616c6c206f722070617274206f6620616e204945544620496e7465726e65742d4472616674206f722052464320616e6420616e792073746174656d656e74206d6164652077697468696e2074686520636f6e74657874206f6620616e204945544620616374697669747920697320636f6e7369646572656420616e20224945544620436f6e747269627574696f6e222e20537563682073746174656d656e747320696e636c756465206f72616c2073746174656d656e747320696e20494554462073657373696f6e732c2061732077656c6c206173207772697474656e20616e6420656c656374726f6e696320636f6d6d756e69636174696f6e73206d61646520617420616e792074696d65206f7220706c6163652c207768696368206172652061646472657373656420746f',
      key:   '36 e5 f6 b5 c5 e0 60 70 f0 ef ca 96 22 7a 86 3e00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00',
      tag:   'f3 47 7e 7c d9 54 17 af 89 a6 b8 79 4c 31 0c f0'
    }
  ];

  for (var i = 0; i < testVectors.length; i++) {
    var input = fromHex(testVectors[i].input);
    var key = fromHex(testVectors[i].key);
    var expected = fromHex(testVectors[i].tag);

    var out = poly1305_auth(input, input.length, key);

    poly1305_verify(expected, out, t);
  }
  t.end();
});
}


poly1305_test();
// aead_test1()
// aead_test2()